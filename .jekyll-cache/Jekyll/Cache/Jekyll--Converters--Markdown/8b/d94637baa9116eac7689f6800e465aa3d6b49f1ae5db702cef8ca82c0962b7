I"áV<p>é€™ç¯‡æ–‡ç« ä¸»è¦åˆ†äº« Flux èˆ‡ Reflux æ¶æ§‹ä¸Šçš„å·®åˆ¥ã€‚å¦‚æœå° React å’Œ Flux æœ‰åŸºæœ¬äº†è§£çš„è©±ï¼Œæœƒè¼ƒèƒ½ç†è§£æœ¬ç¯‡å…§å®¹ã€‚ä¸»è¦åƒè€ƒä¾†æºç‚º<a href="http://blog.krawaller.se/posts/react-js-architecture-flux-vs-reflux/">é€™ç¯‡</a>åœ‹å¤–åˆ†äº«ä»¥åŠè‡ªå·±å¯¦é©—çš„ä¸€äº›å¿ƒå¾—ã€‚</p>

<h2 id="flux-æ¦‚å¿µé›£ä»¥ç†è§£">Flux æ¦‚å¿µé›£ä»¥ç†è§£</h2>
<p>æœ€è¿‘ç”±æ–¼åœ¨å°ˆæ¡ˆçš„é–‹ç™¼ä¸Šæœƒç”¨åˆ° Reactï¼Œåœ¨å­¸ç¿’çš„éç¨‹ä¸­å¿…ç„¶æœƒæ¥è§¸åˆ° Fluxï¼Œé€™å€‹èˆ‡ React æ¯æ¯ç›¸é—œçš„è¨­è¨ˆæ¨¡å¼ã€‚ä½†åœ¨åˆå­¸ Flux çš„éç¨‹ä¸­ï¼Œç›¸ä¿¡æœ‰ä¸å°‘äººåœ¨çœ‹å®Œæ•™å­¸å¾Œå°æ•´å€‹è¨­è¨ˆæ¶æ§‹é‚„æ˜¯å¾ˆè¿·èŒ«ã€‚</p>

<p>React å°è¨±å¤šäººä¾†èªªæœ€å¤§çš„å„ªé»å°±æ˜¯å­¸ç¿’æ›²ç·šç›¸å°ä¾†å¾—ä½ï¼Œåªè¦ææ‡‚ props èˆ‡ state çš„å·®åˆ¥å°±å·²ç¶“å·®ä¸å¤šå¯ä»¥é–‹å§‹æ‹¿ä¾†ç”¨äº†ï¼Œç®—æ˜¯ç›¸ç•¶å¥½ä¸Šæ‰‹ã€‚å›éé ­ä¾†çœ‹çœ‹å…¶ä»–æ¡†æ¶ï¼Œä¾‹å¦‚ Angularï¼Œæƒ³å®Œå…¨é§•é¦­å®ƒä¹‹å‰ä½ å¿…é ˆå…ˆäº†è§£<a href="https://docs.angularjs.org/guide/concepts">é€™äº›</a>ã€‚</p>

<p>Flux å¾ˆå®Œç¾çš„æŠŠä¸Šè¿°çš„ React å„ªé»çµ¦æ¯€äº†ï¼Œæƒ³è¦ææ‡‚ Flux å°±å¿…é ˆåƒ Angular ä¸€æ¨£ï¼ŒæŠ•å…¥ä¸€å®šç¨‹åº¦çš„æ™‚é–“ä¾†ç†è§£èˆ‡æ¶ˆåŒ–æ•´å€‹æ¦‚å¿µã€‚</p>

<p>Flux æ¦‚å¿µåœ–ï¼š
<img src="http://blog.krawaller.se/img/flux-diagram.png" alt="Image of Flux" /></p>

<h2 id="reflux-çš„å‡ºç¾">Reflux çš„å‡ºç¾</h2>
<p>ç•¶æœ‰äººè¦ºå¾—æŸç¨®æ¦‚å¿µå¾ˆè¤‡é›œé›£ä»¥ç†è§£æ™‚ï¼Œç›¸å°çš„å°±æœƒæœ‰äººä»¥å¦ä¸€ç¨®æ–¹å¼ä¾†è©®é‡‹æˆ–ç°¡åŒ–é€™å€‹æ¦‚å¿µã€‚Mikael Brassman é–‹ç™¼å‡ºçš„ <a href="https://github.com/spoike/refluxjs">Reflux</a> ç°¡åŒ–äº†åŸæœ¬ Flux ç¹ç‘£çš„ç¨‹å¼ç¢¼ï¼Œä½¿æ•´å€‹è³‡æ–™å‚³è¼¸çš„æµç¨‹æ›´åŠ å®¹æ˜“ç†è§£ã€‚</p>

<p>ç‚ºäº†ç†è§£ Reflux æ˜¯å¦‚ä½•ç°¡åŒ–æ•´å€‹è³‡æ–™æµçš„å‚³è¼¸ï¼Œä»¥ä¸‹æœƒåˆ†åˆ¥ä½¿ç”¨ä¸Šè¿°å…©ç¨®æ¶æ§‹ä¾†è£½ä½œåŒä¸€å€‹ç°¡æ˜“äººå“¡åå–®ï¼ˆå¯æ–°å¢ï¼Œåˆªé™¤äººå“¡ï¼‰çš„æ‡‰ç”¨ç¨‹å¼ä¾†åšæ¯”è¼ƒã€‚</p>

<h2 id="ä¾è³´æ€§æ¯”è¼ƒ">ä¾è³´æ€§æ¯”è¼ƒ</h2>
<p>é¦–å…ˆï¼Œä½¿ç”¨ Reflux æ„å‘³è‘—å¿…é ˆä½¿ç”¨ Reflux å‡½å¼åº«ï¼Œéœ€è¦é€é npm å®‰è£ã€‚
Flux é›–ç„¶æ˜¯ä¸€ç¨®è¨­è¨ˆæ¨¡å¼ï¼Œä½†åœ¨å¯¦åšä¸Šï¼Œé‚„æ˜¯æœƒéœ€è¦ä½¿ç”¨åˆ° Facebook æä¾›çš„ <a href="https://github.com/facebook/flux/blob/master/src/Dispatcher.js">Dispatcher</a>ã€‚ 
å¯¦éš›ä½¿ç”¨ Reflux æ™‚ï¼Œåªæ˜¯æŠŠ <code class="language-plaintext highlighter-rouge">require('flux')</code> æ›æˆ <code class="language-plaintext highlighter-rouge">require('reflux')</code>ã€‚</p>

<h2 id="action-æ¯”è¼ƒ">Action æ¯”è¼ƒ</h2>
<p>åœ¨å…ƒä»¶è£¡å‘¼å«ç‰¹å®š Action çš„ç¨‹å¼ç¢¼åœ¨å…©ç¨®æ¶æ§‹è£¡æ˜¯å®Œå…¨ä¸€æ¨£çš„ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">handleDelete</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">appActions</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>
<p>å„˜ç®¡å…©ç¨®æ¶æ§‹ä¸å®Œå…¨ç›¸åŒï¼ŒappActions éƒ½æ˜¯ç”¨ä¾†å‘¼å«ç‰¹å®šçš„ Action ä¾†åŸ·è¡Œã€‚ä»¥ä¸Šç¨‹å¼ç¢¼å°±æ˜¯ç”¨ä¾†å‘¼å«åˆªé™¤ä½¿ç”¨è€…é€™å€‹ Actionã€‚</p>

<h2 id="å…ƒä»¶å¾-store-å–è³‡æ–™çš„æ¯”è¼ƒ">å…ƒä»¶å¾ Store å–è³‡æ–™çš„æ¯”è¼ƒ</h2>
<p>åœ¨å–è³‡æ–™éƒ¨åˆ†ï¼Œå…©ç¨®æ¶æ§‹ä¸Šåƒ…æœ‰äº›å¾®å·®ç•°ï¼Œæˆ‘å€‘å…ˆä¾†çœ‹çœ‹ Fluxï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentWillMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">appStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
<span class="p">},</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>Flux åœ¨ <code class="language-plaintext highlighter-rouge">componentDidMount</code> æ™‚åŠ å…¥äº†åµæŸ¥ Store è®ŠåŒ–çš„ listenerï¼Œæ¥è‘—å†ç”±å›å‘¼å‡½å¼ä¾†å°‡å…ƒä»¶å…§éƒ¨åšæ›´æ–°çš„å‹•ä½œã€‚
æˆ‘å€‘å†ä¾†çœ‹çœ‹ Refluxï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ExampleApp</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="na">mixins</span><span class="p">:</span> <span class="p">[</span><span class="nx">reflux</span><span class="p">.</span><span class="nx">ListenerMixin</span><span class="p">],</span>
    <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="nx">appStore</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">//å…¶ä»–çœç•¥</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Reflux é€é mixin å¹«å…ƒä»¶åŠ å…¥äº† <code class="language-plaintext highlighter-rouge">listenTo()</code> çš„æ–¹æ³•ï¼Œç”¨ä¾†åµæ¸¬ä»»ä½• Store çš„æ”¹è®Šï¼ŒåŒæ¨£ç”±ä¸€å€‹å›å‘¼å‡½å¼ (ä¸Šè¿°ä¾‹å­æ˜¯ <code class="language-plaintext highlighter-rouge">this._onChange</code> )ä¾†è™•ç†å…ƒä»¶å…§éƒ¨çš„è³‡æ–™æ›´æ–°ã€‚</p>

<h2 id="store-æ¯”è¼ƒ">Store æ¯”è¼ƒ</h2>
<p>æœ‰è¶£çš„éƒ¨åˆ†ä¾†äº†ï¼Œé¦–å…ˆä¾†çœ‹çœ‹ Flux æ¶æ§‹ä¸‹çš„ Storeï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">appStore</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">getUserList</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_userList</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">addUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_userList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">deleteUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_userList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">emitChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">addChangeListener</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">removeChangeListener</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">appDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">ADD_USER</span><span class="p">:</span>
            <span class="nx">appStore</span><span class="p">.</span><span class="nx">addUser</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">DELETE_USER</span><span class="p">:</span>
            <span class="nx">appStore</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">appStore</span><span class="p">.</span><span class="nx">emitChange</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>Flux æ¶æ§‹ä¸‹çš„ Store éœ€è¦é€é Dispatcher å‚³éä¾†çš„ Action é¡å‹å­—ä¸²ä¾†æ±ºå®šæ¥ä¸‹ä¾†è©²æ€éº¼åšï¼ŒåŒæ™‚å¾—æä¾›å¤–éƒ¨å…ƒä»¶ç”¨ä¾†åµæ¸¬é€™å€‹ Store è®ŠåŒ–çš„æ–¹æ³• ï¼ˆ <code class="language-plaintext highlighter-rouge">addChangeListener()</code>ï¼Œ<code class="language-plaintext highlighter-rouge">emitChange()</code>ï¼Œ <code class="language-plaintext highlighter-rouge">removeChangeListener()</code>ï¼‰ã€‚
æ¥è‘—çœ‹çœ‹ Refluxï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">appStore</span> <span class="o">=</span> <span class="nx">reflux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
	<span class="na">init</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="nx">appActions</span><span class="p">.</span><span class="nx">addUser</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onAddUser</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="nx">appActions</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onDeleteUser</span><span class="p">);</span>
    <span class="p">},</span>
	<span class="na">onAddUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
		<span class="nx">_userList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">_userList</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="na">onDeleteUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
		<span class="nx">_userList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">_userList</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="na">getUserList</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
		<span class="k">return</span> <span class="nx">_userList</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>Reflux é€é <code class="language-plaintext highlighter-rouge">createStore()</code> ä¾†è¨­å®š Storeã€‚åœ¨ Reflux ä¸­ï¼ŒStore è·³é Dispatcher é€™å±¤ä¸¦ç›´æ¥å°å„å€‹ Action åšåµæ¸¬çš„å‹•ä½œã€‚åœ¨ Store å…§éœ€è¦åšçš„å°±æ˜¯è¨­å®šå„ç¨® Action çš„å›å‘¼å‡½å¼ä¸¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">trigger</code> è®“å…ƒä»¶çŸ¥é“ Store æœ‰è®ŠåŒ–äº†ã€‚è°æ˜çš„å„ä½å¯èƒ½æœƒæ³¨æ„åˆ°ï¼Œç•¶æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼è®Šè¤‡é›œï¼ŒAction è¶Šè®Šè¶Šå¤šæ™‚ï¼Œ<code class="language-plaintext highlighter-rouge">init()</code> çš„å…§å®¹ä¹Ÿæœƒéš¨ä¹‹æ“´å¢ã€‚Reflux å·²ç¶“å¹«å„ä½æƒ³åˆ°é€™é»ï¼Œæˆ‘å€‘å¯ä»¥æ”¹ç”¨ä»¥ä¸‹çš„æ–¹å¼ä¾†ç¸®çŸ­ç¨‹å¼ç¢¼ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">appStore</span> <span class="o">=</span> <span class="nx">reflux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
	<span class="na">listenables</span><span class="p">:</span> <span class="nx">appActions</span><span class="p">,</span>
	<span class="na">onAddUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
		<span class="nx">_userList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">_userList</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="na">onDeleteUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
		<span class="nx">_userList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">_userList</span><span class="p">);</span>
	<span class="p">},</span>
	<span class="na">getUserList</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
		<span class="k">return</span> <span class="nx">_userList</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>é€é <code class="language-plaintext highlighter-rouge">listenables</code>ï¼ŒReflux æœƒå¹« appActions å…§çš„æ‰€æœ‰ Action è‡ªå‹•è¨»å†Šä¸€å€‹ â€on + äº‹ä»¶åç¨±â€œ çš„å›å‘¼å‡½å¼ï¼Œæˆ‘å€‘éœ€è¦åšçš„å°±åªæ˜¯å®šç¾©é€™äº›å›å‘¼å‡½å¼è€Œå·²ã€‚åœ¨ Store éƒ¨åˆ†ï¼Œæˆ‘å€‘å·²ç¶“å¯ä»¥æ¼¸æ¼¸çœ‹åˆ° Reflux ç‚ºæˆ‘å€‘ç¸®æ¸›ç¨‹å¼ç¢¼çš„å¥½è™•å›‰ã€‚</p>

<h2 id="action-æ¯”è¼ƒ-1">Action æ¯”è¼ƒ</h2>
<p>ä»¥ä¸‹ç‚º Flux æ¶æ§‹ä¸‹çš„ Action è¨­å®šï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">appActions</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">addUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
		<span class="nx">appDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
			<span class="na">actionType</span><span class="p">:</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">ADD_USER</span><span class="p">,</span>
			<span class="na">data</span><span class="p">:</span> <span class="nx">user</span>
		<span class="p">});</span>
	<span class="p">},</span>
	<span class="na">deleteUser</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
		<span class="nx">appDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
			<span class="na">actionType</span><span class="p">:</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">DELETE_USER</span><span class="p">,</span>
			<span class="na">data</span><span class="p">:</span> <span class="nx">index</span>
		<span class="p">});</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>Flux çš„ Action éœ€è¦é‡å°æ¯å€‹ Action è¨­å®šä¸€å€‹é¡å‹ï¼Œä»¥ä¾¿ Store åœ¨æ¥æ”¶æ™‚åšæ¯”å°ã€‚åœ¨ Action è¶Šä¾†è¶Šå¤šçš„ç‹€æ³ä¸‹ï¼ŒappActions çš„å†—é•·åº¦å¯æƒ³è€ŒçŸ¥ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹çœ‹ Reflux çš„ Actionï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">appActions</span> <span class="o">=</span> <span class="nx">reflux</span><span class="p">.</span><span class="nx">createActions</span><span class="p">([</span>
	<span class="dl">'</span><span class="s1">addUser</span><span class="dl">'</span><span class="p">,</span>
	<span class="dl">'</span><span class="s1">deleteUser</span><span class="dl">'</span>
<span class="p">]);</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>åœ¨ Reflux åº•ä¸‹ï¼Œåªéœ€è¦é€é <code class="language-plaintext highlighter-rouge">createAction()</code> é€™å€‹æ–¹æ³•ä¸¦å‚³å…¥ä¸€å€‹å­—ä¸²çš„é™£åˆ—å°±å¯è¼•é¬†è¨­å®šå¥½ Action å›‰ã€‚</p>

<h2 id="dispatcher-æ¯”è¼ƒ">Dispatcher æ¯”è¼ƒ</h2>
<p>æœ€å¾Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ Dispatcherã€‚
Flux ç‰ˆçš„ Dispatcherï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Dispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">flux</span><span class="dl">'</span><span class="p">).</span><span class="nx">Dispatcher</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">appDispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>

<span class="nx">appDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
    	<span class="na">actionType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">VIEW_ACTION</span><span class="dl">'</span><span class="p">,</span>
    	<span class="na">action</span><span class="p">:</span> <span class="nx">action</span>
    <span class="p">});</span>
<span class="p">};</span>
<span class="c1">//å…¶ä»–çœç•¥</span>
</code></pre></div></div>

<p>é€™è£çš„ <code class="language-plaintext highlighter-rouge">handleViewAction</code> æ˜¯é¸æ“‡æ€§çš„ã€‚ä¸»è¦æ˜¯ç‚ºäº†å€åˆ† Action çš„ä¾†æºï¼ˆæœ‰å¯èƒ½æœƒæœ‰ä¾†è‡ª Server çš„ Action ï¼‰ã€‚
Reflux ç‰ˆçš„ Dispatcherï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//å®Œå…¨ä¸éœ€è¦</span>
</code></pre></div></div>

<p>æ˜¯çš„ï¼Œä½ æ²’çœ‹éŒ¯ã€‚åœ¨ Reflux æ¶æ§‹ä¸­ Store æ˜¯ç›´æ¥åµæ¸¬ Actionï¼Œè€Œä¸æ˜¯é€é Dispatcher å°‡ Action ç™¼ä½ˆçµ¦ Storeã€‚å› æ­¤ï¼ŒReflux å®Œå…¨ä¸éœ€è¦ Dispatcherã€‚</p>

<h2 id="ç¸½çµ">ç¸½çµ</h2>
<p>çœ‹å®Œäº†ä¸Šé¢çš„æ¯”è¼ƒï¼Œç›¸ä¿¡å¤§å®¶æ‡‰è©²å¯ä»¥äº†è§£åˆ° Reflux æ˜¯å¦‚ä½•ç¸®çŸ­ç¨‹å¼ç¢¼ä¸¦å°‡æ•´å€‹è³‡æ–™å‚³è¼¸æµç¨‹ç¸®çŸ­ã€‚åœ¨ Reflux ä¸­ï¼šå…ƒä»¶è² è²¬åµæ¸¬ Store çš„è®ŠåŒ–ä¸¦è§¸ç™¼å„ç¨® Actionï¼ŒStore åµæ¸¬åˆ°ä¸åŒçš„ Action ä¸¦åšå‡ºç›¸å°æ‡‰çš„æ›´æ–°ã€‚
<img src="http://blog.krawaller.se/img/reflux-flow.jpg" alt="Image of Reflux" />
é›–ç„¶æ•´é«”çš„ç¨‹å¼ç¢¼æ¸›å°‘äº†ï¼Œä½†ä¸¦ä¸ä»£è¡¨æˆ‘å€‘ä¸éœ€è¦å»äº†è§£ Fluxã€‚Flux èˆ‡ Reflux å„æœ‰å„ªç¼ºï¼Œè€Œç¨‹å¼è¨­è¨ˆå¸«å‰‡éœ€è¦æ ¹æ“šéœ€æ±‚è€Œæ±ºå®šä½¿ç”¨çš„è¨­è¨ˆæ¨¡å¼ã€‚
ä»¥ä¸Šç¨‹å¼ç¢¼å¯åœ¨<a href="https://github.com/Rhadow/Flux-Reflux-Practice">é€™è£</a>æŸ¥çœ‹ã€‚å¦‚æœæ–‡ç« ä¸­æœ‰ä»»ä½•å•é¡Œï¼Œä¹Ÿæ­¡è¿å„ä½è¨è«–ç³¾æ­£ã€‚</p>
:ET