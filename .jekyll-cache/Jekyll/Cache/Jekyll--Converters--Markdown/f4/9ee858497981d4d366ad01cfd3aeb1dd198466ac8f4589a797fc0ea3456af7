I"·j<p>å–®å…ƒæ¸¬è©¦åœ¨è»Ÿé«”é–‹ç™¼éç¨‹ä¸­æ˜¯ä¸€å€‹å¾ˆé‡è¦ä½†å¸¸è¢«å¿½ç•¥çš„ç’°ç¯€ã€‚å–®å…ƒæ¸¬è©¦æœ‰è‘—è¨±å¤šå„ªé»ï¼Œä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥å¤§å¹…åº¦æ›´å‹•åŸæœ¬çš„ç¨‹å¼ç¢¼ä¸¦ä¸”ä¸ç”¨æ“”å¿ƒæœ‰å“ªé‚Šè¢«æ”¹å£äº†ï¼Œå› ç‚ºåªè¦å–®å…ƒæ¸¬è©¦éƒ½é€šéäº†ï¼Œå°±ä»£è¡¨è‘—æ–°æ›´å‹•éçš„ç¨‹å¼æ˜¯æ²’å•é¡Œçš„ã€‚å› æ­¤ï¼Œå¦‚ä½•å¯«å‡ºå¥½çš„å–®å…ƒæ¸¬è©¦ä¹Ÿæ˜¯ä¸€é–€å€¼å¾—ç ”ç©¶çš„èª²é¡Œã€‚æœ¬ç¯‡å°‡ç”¨ä¸€å€‹ç°¡å–®çš„ä¾‹å­åˆ†äº«å¦‚ä½•ä½¿ç”¨ Facebook çš„å–®å…ƒæ¸¬è©¦æ¡†æ¶ <a href="https://facebook.github.io/jest/">Jest</a> ä¾†æ¸¬è©¦ React å…ƒä»¶ã€‚</p>

<h2 id="jest-æ˜¯ä»€éº¼">Jest æ˜¯ä»€éº¼</h2>

<p>Jest æ˜¯ Facebook é–‹ç™¼ç”¨ä¾†åœ¨ React å°ˆæ¡ˆä¸Šåšå–®å…ƒæ¸¬è©¦çš„æ¡†æ¶ã€‚é›–ç„¶èªªæ˜¯ Facebook é–‹ç™¼çš„ï¼Œä½†å…¶å¯¦ Jest æ˜¯åŸºæ–¼åŸæœ¬å°±å¾ˆæœ‰åçš„ <a href="http://jasmine.github.io/">Jasmine</a> æ¸¬è©¦æ¡†æ¶æ‰€è¡ç”Ÿå‡ºä¾†çš„ã€‚å› æ­¤ï¼Œåœ¨ Jest ä¸­å…¶å¯¦å¯ä»¥çœ‹åˆ°è¨±å¤š Jasmine å…§çš„æ–¹æ³• (åƒæ˜¯ <code class="language-plaintext highlighter-rouge">toBe()</code> <code class="language-plaintext highlighter-rouge">toEqual()</code> ç­‰ç­‰)ã€‚ä½ å¯èƒ½æœƒå•: æœ‰é€™éº¼å¤šçš„æ¸¬è©¦æ¡†æ¶å¯ä»¥é¸æ“‡ï¼Œç‚ºä»€éº¼è¦é¸ Jest å‘¢? Jest æœ€å¤§çš„ç‰¹é»åœ¨æ–¼å®ƒæœƒåœ¨æ¸¬è©¦æ™‚è‡ªå‹•æ¨¡æ“¬ (mock) é€é <code class="language-plaintext highlighter-rouge">require()</code> é€²ä¾†çš„æ¨¡çµ„ï¼Œè®“ä½ å°ˆæ³¨åœ¨ç›®å‰è¢«æ¸¬è©¦çš„æ¨¡çµ„ä¸­ã€‚</p>

<p>æ¨¡æ“¬åŒ–æ˜¯æŒ‡åªåšå‡ºè©²æ¨¡çµ„çš„ç©ºæ®¼ï¼Œè£¡é¢çš„å¯¦éš›é‚è¼¯éƒ½ä¸å­˜åœ¨ã€‚é€™åœ¨æ¸¬è©¦æ™‚ç‰¹åˆ¥æœ‰ç”¨ï¼Œå› ç‚ºæˆ‘å€‘ä¸å¸Œæœ›å…¶ä»–çš„æ¨¡çµ„å½±éŸ¿åˆ°æˆ‘å€‘ç›®å‰æ¸¬è©¦ä¸­çš„æ¨¡çµ„ã€‚è©³ç´°è«‹åƒè€ƒ <a href="https://facebook.github.io/jest/docs/common-js-testing.html#content">CommonJS Testing</a> å’Œ <a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks Arenâ€™t Stubs</a>ã€‚</p>

<h2 id="æº–å‚™">æº–å‚™</h2>

<p>åœ¨æ¸¬è©¦é–‹å§‹å‰éœ€è¦å…ˆåšä¸€äº›å®‰è£èˆ‡æº–å‚™ã€‚ç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯é€é <code class="language-plaintext highlighter-rouge">npm install jest-cli</code> ä¾†å®‰è£ Jestã€‚å¦‚æœæ˜¯ä½¿ç”¨ Windows çš„é–‹ç™¼è€…ï¼Œä½ å¯èƒ½æœƒç¢°åˆ°å®‰è£ä¸Šçš„å•é¡Œï¼Œå»ºè­°åƒè€ƒ<a href="http://ryanlanciaux.github.io/blog/2014/08/02/using-jest-for-testing-react-components-on-windows/">åœ‹å¤–æä¾›çš„è§£æ³•</a>ï¼Œé€™è£¡å°±ä¸å¤šåšèªªæ˜ã€‚</p>

<p>æ¥ä¸‹ä¾†è«‹åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„å»ºç«‹ä¸€å€‹ <code class="language-plaintext highlighter-rouge">__tests__</code> çš„è³‡æ–™å¤¾ç”¨ä¾†æ”¾æˆ‘å€‘å¯«çš„å–®å…ƒæ¸¬è©¦æª”æ¡ˆï¼ŒJest åœ¨åŸ·è¡Œæ™‚æœƒè‡ªå‹•æœå°‹é€™å€‹è³‡æ–™å¤¾è£¡çš„æª”æ¡ˆä¸¦ä¸€ä¸€åŸ·è¡Œæ¸¬è©¦ã€‚</p>

<p>æ¥è‘—ï¼Œä¸€æ¨£åœ¨æ ¹ç›®éŒ„æ–°å‰µä¸€å€‹å« <code class="language-plaintext highlighter-rouge">preprocessor.js</code> çš„æª”æ¡ˆï¼Œå…§å®¹ç‚º:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// preprocessor.js</span>
<span class="kd">var</span> <span class="nx">ReactTools</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react-tools</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">process</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ReactTools</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>é€™å€‹æª”æ¡ˆçš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨æ¸¬è©¦æ™‚ç”¨ä¾†æŠŠ jsx è½‰æ›æˆä¸€èˆ¬çš„ javascriptã€‚</p>

<p>æœ€å¾Œä¸€æ­¥å‰‡æ˜¯åˆ° <code class="language-plaintext highlighter-rouge">package.json</code> æª”å…§åšè¨­å®š:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// package.json</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jest</span><span class="dl">"</span>
    <span class="p">}</span>
    <span class="dl">"</span><span class="s2">dependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">react-tools</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">jest</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">scriptPreprocessor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">&lt;rootDir&gt;/preprocessor.js</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">unmockedModulePathPatterns</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>React åœ¨æœ€åˆè¨­è¨ˆæ™‚å°±è¢«è¨­è¨ˆç‚ºä¸éœ€è¦è¢«æ¨¡æ“¬ä¹Ÿèƒ½åŸ·è¡Œæ¸¬è©¦ï¼Œå› æ­¤æˆ‘å€‘ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">unmockedModulePathPatterns</code> ä¾†é˜²æ­¢ React åœ¨æ¸¬è©¦æ™‚è¢«æ¨¡æ“¬åŒ–ã€‚
ä»¥ä¸Šè¨­å®šå®Œæˆå¾Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">npm test</code> çš„æŒ‡ä»¤é–‹å§‹æ¸¬è©¦ã€‚</p>

<h2 id="è¢«æ¸¬è©¦çš„å…ƒä»¶">è¢«æ¸¬è©¦çš„å…ƒä»¶</h2>

<p>ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ React å…ƒä»¶ï¼Œå…§å®¹æœ‰å…©å€‹è¼¸å…¥æ¡†ï¼Œä¸€å€‹æ˜¯ç”¨ä¾†å¡«åå­—ï¼Œå¦ä¸€å€‹ç”¨ä¾†å¡«å¹´é½¡ã€‚å®ƒé‚„æœ‰ä¸€å€‹ç¢ºå®šæŒ‰éˆ•ï¼Œé€é Action å°‡ä½¿ç”¨è€…è¼¸å…¥çš„å…§å®¹ç™¼é€å‡ºå»ã€‚åœ¨ç™¼é€ Action ä¹‹å‰ï¼Œæœƒå…ˆæª¢æŸ¥è¼¸å…¥æ¡†ç‹€æ…‹ï¼Œå¦‚æœä»»ä½•ä¸€å€‹æœ‰ç•™ç©ºçš„è©±å‰‡ä¸æœƒç™¼é€ Actionã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">appActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../actions/appActions.js</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Input</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="na">handleSubmit</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">,</span>
            <span class="na">age</span><span class="p">:</span> <span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span>
        <span class="p">};</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">newUser</span><span class="p">.</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">newUser</span><span class="p">.</span><span class="nx">age</span><span class="p">){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
            <span class="nx">appActions</span><span class="p">.</span><span class="nx">addUser</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="cm">/* jshint ignore:start */</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Please enter your name</span><span class="dl">"</span> <span class="nx">ref</span><span class="o">=</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Please enter your age</span><span class="dl">"</span> <span class="nx">ref</span><span class="o">=</span><span class="dl">"</span><span class="s2">age</span><span class="dl">"</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span> <span class="nx">value</span><span class="o">=</span><span class="dl">"</span><span class="s2">Add</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="cm">/* jshint ignore:end */</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Input</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="å–®å…ƒæ¸¬è©¦æª”æ¡ˆ">å–®å…ƒæ¸¬è©¦æª”æ¡ˆ</h2>

<p>å…ˆä¾†çœ‹çœ‹ç¨‹å¼ç¢¼:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//__tests__/Input-test.js</span>

<span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">dontMock</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app/components/Input.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Input Component</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Input</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app/components/Input.js</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react/addons</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">appActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app/actions/appActions.js</span><span class="dl">'</span><span class="p">),</span>
        <span class="nx">TestUtils</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">TestUtils</span><span class="p">,</span>
        <span class="nx">tree</span><span class="p">,</span>
        <span class="nx">inputElements</span><span class="p">,</span>
        <span class="nx">nameElement</span><span class="p">,</span>
        <span class="nx">ageElement</span><span class="p">,</span>
        <span class="nx">submitElement</span><span class="p">;</span>

    <span class="nx">tree</span> <span class="o">=</span> <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">renderIntoDocument</span><span class="p">(</span>
        <span class="cm">/* jshint ignore:start */</span>
        <span class="o">&lt;</span><span class="nx">Input</span> <span class="o">/&gt;</span>
        <span class="cm">/* jshint ignore:end */</span>
    <span class="p">);</span>

    <span class="nx">inputElements</span> <span class="o">=</span> <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">scryRenderedDOMComponentsWithTag</span><span class="p">(</span><span class="nx">tree</span><span class="p">,</span> <span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">nameElement</span> <span class="o">=</span> <span class="nx">inputElements</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">ageElement</span> <span class="o">=</span> <span class="nx">inputElements</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nx">submitElement</span> <span class="o">=</span> <span class="nx">inputElements</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
        <span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
        <span class="nx">appActions</span><span class="p">.</span><span class="nx">addUser</span><span class="p">.</span><span class="nx">mockClear</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should keep user</span><span class="se">\'</span><span class="s1">s input if the input format is wrong</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">Simulate</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitElement</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">).</span><span class="nx">toBeFalsy</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should clear user</span><span class="se">\'</span><span class="s1">s input if the input formats are correct</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
        <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">Simulate</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitElement</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should send add user action with correct data when the inputs format are correct</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
        <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">Simulate</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitElement</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">appActions</span><span class="p">.</span><span class="nx">addUser</span><span class="p">).</span><span class="nx">toBeCalledWith</span><span class="p">({</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">age</span><span class="p">:</span> <span class="mi">27</span>
        <span class="p">});</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should not send add user action when the inputs format are wrong</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">nameElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Tester</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">ageElement</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">wrong input</span><span class="dl">'</span><span class="p">;</span>
        <span class="nx">TestUtils</span><span class="p">.</span><span class="nx">Simulate</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitElement</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">appActions</span><span class="p">.</span><span class="nx">addUser</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeCalled</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç¬¬ä¸€è¡Œéå¸¸é‡è¦: <code class="language-plaintext highlighter-rouge">jest.dontMock('../src/app/components/Input.js');</code></p>

<p>Jest é è¨­åœ¨ <code class="language-plaintext highlighter-rouge">require()</code> æ™‚æœƒè‡ªå‹•æ¨¡æ“¬ (mock) åŒ–é€²ä¾†çš„æ¨¡çµ„ï¼Œå› æ­¤é€™è¡Œæˆ‘å€‘å‘Šè¨´ Jest ç•¶ <code class="language-plaintext highlighter-rouge">require('../src/app/components/Input.js')</code> æ™‚ï¼Œä¸è¦æ¨¡æ“¬ (donâ€™t mock) åŒ–æ­¤æ¨¡çµ„ï¼Œæˆ‘å€‘éœ€è¦æ­£å¸¸ç‰ˆçš„ Input å…ƒä»¶ä¾†åšæ¸¬è©¦ã€‚</p>

<p>ç¨‹å¼ç¢¼å…§å‡ºç¾çš„ <code class="language-plaintext highlighter-rouge">describe()</code>ï¼Œ<code class="language-plaintext highlighter-rouge">it()</code>ï¼Œ<code class="language-plaintext highlighter-rouge">expect()</code> æ˜¯ jasmine å…§åŸä¾†å°±æœ‰çš„æ–¹æ³•ã€‚ä¸»è¦æ˜¯è®“æˆ‘å€‘çš„æ¸¬è©¦ç¨‹å¼è®€èµ·ä¾†å°±åƒæ˜¯ä¸€èˆ¬è‹±æ–‡çš„å¥å­ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">sum</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">adds 1 + 2 to equal 3</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../sum</span><span class="dl">'</span><span class="p">);</span>
       <span class="nx">expect</span><span class="p">(</span><span class="nx">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>æˆ‘å€‘å¯ä»¥æŠŠä»¥ä¸Šç¨‹å¼ç¢¼ç¿»æˆé€™æ¨£çš„ä¸­æ–‡:</p>

<blockquote>
  <p>é€™æ®µç¨‹å¼ç¢¼å°‡æè¿° (describe) â€œsumâ€ é€™å€‹æ–¹æ³•ï¼Œå®ƒ (it) å°‡ â€œä¸€å’ŒäºŒç›¸åŠ ä¸¦è¼¸å‡ºä¸‰â€ã€‚
é è¨ˆ(expect) åŸ·è¡Œ sum(1,2) å¾Œå¾—åˆ°çš„çµæœæœƒæ˜¯ 3ã€‚</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">beforeEach()</code> ä¹Ÿæ˜¯ä¸€å€‹ Jasmine åŸæœ‰çš„æ–¹æ³•ã€‚
ä½¿ç”¨æ–¹å¼æ˜¯ä¸Ÿä¸€å€‹å‡½å¼é€²å»ï¼Œä½œç”¨æ˜¯ä¹‹å¾Œæ¯æ¬¡åšå°æ¸¬è©¦ (<code class="language-plaintext highlighter-rouge">it(...)</code>) ä¹‹å‰éƒ½æœƒåŸ·è¡Œä¸€æ¬¡æˆ‘å€‘ä¸Ÿé€²å»çš„å‡½å¼ã€‚
åœ¨ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘æ‹¿ä¾†æ¸…ç©ºè¼¸å…¥æ¡†èˆ‡æ¸…ç©ºæ¨¡æ“¬åŒ–éçš„ action ç´€éŒ„ã€‚</p>

<p>React æœ‰æä¾›ä¸€ç³»åˆ—çš„<a href="https://facebook.github.io/react/docs/test-utils.html">æ¸¬è©¦å·¥å…·</a>ï¼Œæˆ‘å€‘æœƒç”¨å®ƒå€‘ä¾†æ¨¡æ“¬ä¸€äº›äº‹ä»¶ï¼Œåƒæ˜¯ click, change, keydown ä¹‹é¡çš„ã€‚</p>

<p>ç”±æ–¼åœ¨æ¸¬è©¦æ™‚ï¼Œå…ƒä»¶ä¸¦æ²’æœ‰å¯¦éš› render åˆ° DOM ä¸Šï¼Œæˆ‘å€‘å¿…é ˆé€é <code class="language-plaintext highlighter-rouge">renderIntoDocument</code> ä¾†å°‡å…ƒä»¶ render åˆ°ä¸€å€‹è™›æ“¬çš„ DOM ä¸Šã€‚</p>

<p><code class="language-plaintext highlighter-rouge">scryRenderedDOMComponentsWithTag</code> å‰‡æ˜¯è®“æˆ‘å€‘èƒ½å¤ åˆ°ä¸Šè¿°çš„è™›æ“¬ DOM ä¸­æ‰¾å‡ºç‰¹å®š HTML å…ƒç´ ä¸¦å­˜åœ¨ä¸€å€‹é™£åˆ—ä¸­ã€‚åœ¨é€™å€‹ä¾‹å­ï¼Œæˆ‘å€‘æ‰¾å‡ºäº† Input å…ƒä»¶ä¸­æ‰€æœ‰çš„ input å…ƒç´ ã€‚</p>

<p>åœ¨æ¯å€‹å°æ¸¬è©¦ (<code class="language-plaintext highlighter-rouge">it(...)</code>) ä¸­ï¼Œæˆ‘å€‘ä¹Ÿä½¿ç”¨äº† <code class="language-plaintext highlighter-rouge">Simulate</code> é€™å€‹æ–¹æ³•ä¾†å°é€å‡ºæŒ‰éˆ•æ¨¡æ“¬é»æ“Šäº‹ä»¶ã€‚</p>

<p>å»ºè­°å„ä½å¯ä»¥é‚Šå¯«é‚Šçœ‹ Jasmine èˆ‡ React TestUtils çš„å„ç¨®æ–¹æ³•ï¼Œé€™æ¨£åœ¨å¯«æ¸¬è©¦æ™‚èƒ½å¤ å¯«å‡ºæ›´éˆæ´»æ›´æœ‰å½ˆæ€§çš„æ¸¬è©¦ã€‚</p>

<h2 id="ç¸½çµ">ç¸½çµ</h2>

<p>é›–ç„¶ä½¿ç”¨ Jest å° React åšæ¸¬è©¦éå¸¸æ–¹ä¾¿ï¼Œä½†å®ƒä¹Ÿæ²’æœ‰åƒå®˜ç¶²æ‰€èªªçš„â€ç„¡ç—›åšæ¸¬è©¦â€é‚£æ¨£çš„ç„¡ç—›ã€‚
é™¤äº†åœ¨ windows ä¸Šå®‰è£å›°é›£é‡é‡å¤–ï¼ŒJest ç›®å‰åªæ”¯æ´åˆ° NodeJS 0.10 ç‰ˆã€‚æœ€æ–°çš„ 0.12 ç‰ˆèˆ‡ io.js éƒ½æ˜¯æœƒå ±éŒ¯çš„ã€‚é™¤äº†ä¸€äº›ç¼ºé»ä¹‹å¤–ï¼ŒJest çš„ç¢ºç‚ºæˆ‘å€‘çœå»äº†ä¸å°‘å¯«æ¸¬è©¦æ™‚çš„éº»ç…©ã€‚åŒæ™‚ï¼ŒFacebook ä¹Ÿæ˜¯ Jest èˆ‡ React çš„èƒŒå¾Œæ¨æ‰‹ï¼Œç›¸ä¿¡ Jest å° React çš„ç›¸å®¹æ€§æ‡‰è©²ä¸æœƒè¼¸çµ¦å…¶ä»–çš„æ¸¬è©¦æ¡†æ¶ã€‚</p>
:ET