I"³W<p>èˆ‡ React æ­é…çš„å–®å‘è³‡æ–™æµæ¶æ§‹ Flux å·²ç¶“æ¨å‡ºä¸€æ®µæ™‚é–“ï¼Œæƒ³å¿…æœ‰åœ¨ä½¿ç”¨ React çš„é–‹ç™¼è€…å€‘éƒ½å·²ç›¸ç•¶ç†Ÿæ‚‰ã€‚ç¤¾ç¾¤ä¹Ÿé™¸é™¸çºŒçºŒé–‹ç™¼å‡ºè¨±å¤š Flux ç›¸é—œçš„ library åƒæ˜¯ï¼šReflux, Fluxxor, Alt ç­‰ç­‰â€¦ã€‚è€Œæœ€è¿‘æœ‰åœ¨é—œæ³¨ React ç¤¾ç¾¤çš„äººä¸€å®šéƒ½æœ‰è½é <a href="https://github.com/gaearon/redux">Redux</a> é€™å€‹è¿…é€Ÿç«„ç´…çš„ libraryã€‚ä½†ç”±æ–¼ Redux åœ¨è¨­è¨ˆä¸Šèˆ‡åŸç”Ÿçš„ Flux è¼ƒç‚ºä¸åŒï¼Œå› æ­¤å¸Œæœ›èƒ½è—‰ç”±é€™ç¯‡æ–‡ç« å¹«åŠ©å„ä½äº†è§£ Redux çš„åŸºæœ¬é‹ä½œæ–¹å¼ã€‚</p>

<h2 id="redux-æ ¸å¿ƒæ¦‚å¿µ">Redux æ ¸å¿ƒæ¦‚å¿µ</h2>

<ul>
  <li><strong>åªä½¿ç”¨ä¸€å€‹ store å°‡æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„ç‹€æ…‹ (state) ç”¨ç‰©ä»¶æ¨¹ (object tree) çš„æ–¹å¼å„²å­˜èµ·ä¾†ã€‚</strong> åŸç”Ÿçš„ Flux æœƒæœ‰è¨±å¤šåˆ†æ•£çš„ store å„²å­˜å„å€‹ä¸åŒçš„ç‹€æ…‹ï¼Œä½†åœ¨ redux ä¸­ï¼Œåªæœƒæœ‰ä¸€å€‹ store å°‡æ‰€æœ‰çš„è³‡æ–™ç”¨ç‰©ä»¶çš„æ–¹å¼åŒ…èµ·ä¾†ã€‚è«‹çœ‹ä»¥ä¸‹æ¯”å–»ï¼š</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//åŸç”Ÿ Flux çš„ store</span>
<span class="kd">var</span> <span class="nx">firstStore</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">first</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">secondStore</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">second</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="c1">// Redux çš„å–®ä¸€ store</span>
<span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">firstState</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">first</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="na">secondState</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">second</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p><strong>å”¯ä¸€å¯ä»¥æ”¹è®Šé€™å€‹ state çš„æ–¹æ³•å°±æ˜¯ç™¼é€ actionï¼Œé€™å€‹ action å…¶å¯¦å°±åªæ˜¯ä¸€å€‹ç‰©ä»¶å‘Šè¨´ state è©²æ€éº¼æ”¹è®Šè€Œå·²ã€‚</strong> é€™éƒ¨åˆ†ä¿ç•™äº†åŸç”Ÿ flux çš„ç‰¹æ€§ï¼Œç¢ºä¿ state ä¸æœƒè¢«å…¶ä»–çš„å‹•ä½œçµ¦æ›´å‹•ã€‚</p>
  </li>
  <li>
    <p><strong>å¯¦éš›å› æ‡‰ action è£¡çš„å…§å®¹å° state åšè®ŠåŒ–çš„å‡½å¼å«åš reducerã€‚</strong> Reducer æœ‰å…©å€‹åƒæ•¸ï¼Œä¸€å€‹æ˜¯ç¾æœ‰çš„èˆŠ stateï¼Œå¦ä¸€å€‹å°±æ˜¯ actionï¼Œè€Œ reducer å›å‚³çš„å°±æ˜¯ç¶“éæ›´æ–°å¾Œçš„æ–° stateã€‚</p>
  </li>
</ul>

<h2 id="actions">Actions</h2>

<p>Action åœ¨åŸç”Ÿ Flux å’Œ redux è£¡ï¼Œéƒ½æ˜¯ä¸€å€‹å‘ŠçŸ¥ state éœ€è¦æ”¹è®Šçš„ç‰©ä»¶ã€‚é€šå¸¸æœƒé•·å¾—åƒé€™æ¨£ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="nx">ADD_TODO</span><span class="p">,</span>
  <span class="nx">payload</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Build my first Redux app</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é€™éƒ¨åˆ†ä¸¦æ²’æœ‰å¤ªå¤§å·®ç•°ã€‚</p>

<h2 id="action-creators">Action creators</h2>

<p>ä»¥å¾€åœ¨åŸç”Ÿ Flux çš„è¨­è¨ˆä¸­ï¼Œaction creator éœ€è¦åš dispatch çš„å‹•ä½œã€‚
è€Œåœ¨ redux çš„ action creator ä¸­ï¼Œæˆ‘å€‘åªéœ€è¦ç°¡å–®åœ°å°‡ action ç‰©ä»¶å›å‚³å°±å¥½ã€‚</p>

<p>åŸç”Ÿ Flux action creator:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">addTodoWithDispatch</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">ADD_TODO</span><span class="p">,</span>
        <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">text</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="c1">// å¯¦éš›ç™¼é€ action</span>
<span class="nx">addTodoWithDispatch</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
</code></pre></div></div>

<p>Redux action creator:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">addTodo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">ADD_TODO</span><span class="p">,</span>
        <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">text</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// å¯¦éš›ç™¼é€ action</span>
<span class="nx">dispatch</span><span class="p">(</span><span class="nx">addTodo</span><span class="p">(</span><span class="nx">text</span><span class="p">));</span>
<span class="nx">dispatch</span><span class="p">(</span><span class="nx">removeTodo</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
</code></pre></div></div>

<p>åœ¨ redux ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">dispatch()</code> é€™å€‹æ–¹æ³•ä¾†è‡ªæ–¼ <code class="language-plaintext highlighter-rouge">store.dispatch()</code>ï¼Œä½†å°±å¤§éƒ¨ä»½çš„ç‹€æ³ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ä½œè€…åœ¨ <a href="https://github.com/gaearon/react-redux">react-redux</a> å…§æä¾›çš„ <code class="language-plaintext highlighter-rouge">Connector</code> å…ƒä»¶ã€‚æ­¤å…ƒä»¶æœƒå°‡ <code class="language-plaintext highlighter-rouge">dispatch()</code> æ–¹æ³•æŠ½å‡ºä¾†æä¾›æˆ‘å€‘ä½¿ç”¨ï¼Œå› æ­¤ä¸¦ä¸éœ€è¦ç‰¹åˆ¥å¾ store ä¸­æå–ã€‚</p>

<p>è€Œ redux æä¾›çš„å¦ä¸€å€‹æ–¹æ³• <code class="language-plaintext highlighter-rouge">bindActionCreators()</code> å°±æ˜¯å°‡æˆ‘å€‘æä¾›çš„ actionCreator å¤–é¢å†åŒ…ä¸Šä¸€å±¤ <code class="language-plaintext highlighter-rouge">dispatch()</code>ã€‚ä¸€èˆ¬ä¾†èªªï¼Œåœ¨å¯¦ä½œä¸Šé€šå¸¸éƒ½æœƒæƒ³å·æ‡¶ä¸æƒ³å¯«åƒ <code class="language-plaintext highlighter-rouge">dispatch(removeTodo(id))</code> çš„ç¨‹å¼ç¢¼ï¼Œ
å› æ­¤ <code class="language-plaintext highlighter-rouge">bindActionCreators()</code> ç®—æ˜¯ä¸€å€‹å¸¸ç”¨åˆ°çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p>

<h2 id="reducers">Reducers</h2>

<p>Reducer é¡ä¼¼æ–¼åŸç”Ÿ Flux çš„ Storeã€‚ä½†ç”±æ–¼ Redux åªæœ‰ä¸€å€‹ Storeï¼Œé€™äº› reducers çš„åŠŸèƒ½å°±æ˜¯é‡å°é€™å€‹å”¯ä¸€çš„ Store å…§çš„ State çš„éƒ¨åˆ†å…§å®¹é€²è¡Œæ›´æ–°ã€‚Reducer æ¥æ”¶èˆŠ state èˆ‡ action ä¸¦å›å‚³ä¸€å€‹æ–°çš„ state:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">previousState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">newState</span>
</code></pre></div></div>

<p>æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¯¦éš›ç¯„ä¾‹å§ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span> <span class="na">todos</span><span class="p">:</span> <span class="p">[],</span> <span class="na">idCounter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>

<span class="kd">function</span> <span class="nx">todos</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">ADD_TODO</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">todos</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span>
                    <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">idCounter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
                <span class="p">],</span>
                <span class="na">idCounter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">idCounter</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">};</span>
        <span class="k">case</span> <span class="nx">REMOVE_TODO</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">todos</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">todo</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span>
            <span class="p">};</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Reducer æœƒå…ˆæŸ¥çœ‹ action çš„ type æ˜¯ä»€éº¼ä¸¦åšå‡ºç›¸å°æ‡‰çš„å‹•ä½œã€‚ä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">ADD_TODO</code>ï¼Œæœƒåœ¨ <code class="language-plaintext highlighter-rouge">todos</code> æœ€å¾ŒåŠ å…¥ä¸€å€‹æ–°çš„ todo ç‰©ä»¶ä¸¦æŠŠ <code class="language-plaintext highlighter-rouge">action.payload</code> çš„è³‡æ–™æ”¾åˆ° <code class="language-plaintext highlighter-rouge">text</code> ä¸­ï¼ŒåŒæ™‚æ›´æ–° <code class="language-plaintext highlighter-rouge">idCounter</code>ã€‚ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ï¼Œé€™é‚Šå›å‚³çš„æ˜¯<strong>å®Œå…¨æ–°çš„ç‰©ä»¶è€Œä¸æ˜¯ä¿®æ”¹åŸæœ¬ç‰©ä»¶çš„å…§å®¹</strong>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
    <span class="na">todos</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span>
        <span class="p">{</span> <span class="na">text</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">idCounter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">idCounter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">idCounter</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">...state</code> æ˜¯ ES7 çš„å¯«æ³•ï¼Œå¯ä»¥åƒ ES6 æ‰“æ•£ array ä¸€æ¨£åœ°æŠŠç‰©ä»¶å…§å®¹æŠ½å–å‡ºä¾†ã€‚å¦‚æœä½ æ˜¯ä½¿ç”¨ babel çš„è©±ï¼Œè«‹è¨˜å¾—å»èª¿æ•´ babel çš„è¨­å®šã€‚</p>

<h2 id="store">Store</h2>

<p>åœ¨ redux å…§åªæœ‰ä¸€å€‹ storeï¼Œé€™å€‹ store æ˜¯åŸºæ–¼æˆ‘å€‘æ‰€å»ºç«‹çš„è¨±å¤š reducers ä¸Šã€‚Redux æœ‰æä¾› <code class="language-plaintext highlighter-rouge">createStore()</code> çš„æ–¹æ³•ã€‚</p>

<p>å–®ä¸€ reducer æ™‚å»ºç«‹ store çš„æ–¹å¼:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">todos</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../reducers/todos</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">todos</span><span class="p">);</span>
</code></pre></div></div>

<p>ä½†ä¸€èˆ¬ä¾†èªªï¼Œæˆ‘å€‘çš„ app éƒ½æœƒåŒ…å«å¤šå€‹ reducersï¼Œé€™æ™‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">combineReducers()</code> é€™å€‹æ–¹æ³•å°‡å¤šå€‹ reducers åˆä½µç‚ºä¸€å€‹ reducer å†ä¸Ÿçµ¦ <code class="language-plaintext highlighter-rouge">createStore()</code> ä¾†åšå‡º storeã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">todos</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">counter</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¤šå€‹ reducers æ™‚å»ºç«‹ store çš„æ–¹å¼:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">reducers</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../reducers</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">(</span><span class="nx">reducers</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>
</code></pre></div></div>

<p>å»ºç«‹å‡ºä¾†çš„ store æœƒæ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œå…§å®¹å±¬æ€§å¦‚ä¸‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">,</span>
    <span class="nx">subscribe</span><span class="p">,</span>
    <span class="nx">getState</span><span class="p">,</span>
    <span class="nx">getReducer</span><span class="p">,</span>
    <span class="nx">replaceReducer</span>
<span class="p">};</span>
</code></pre></div></div>

<p>å…¶ä¸­çš„ <code class="language-plaintext highlighter-rouge">getState()</code> æœƒå›å‚³æ•´å€‹æ‡‰ç”¨çš„å–®ä¸€ stateã€‚å¦‚æœä»¥ä¸Šè¿°çš„å…©å€‹ reducers ä¾†èªªï¼Œåšå‡ºä¾†çš„ state æœƒé•·çš„åƒæ˜¯é€™æ¨£ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>

<span class="c1">// çµæœï¼š</span>
<span class="p">{</span>
    <span class="na">todos</span><span class="p">:</span> <span class="nx">todoState</span><span class="p">,</span>
    <span class="na">counter</span><span class="p">:</span> <span class="nx">counterState</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="èˆ‡å…ƒä»¶é€£çµ">èˆ‡å…ƒä»¶é€£çµ</h2>

<p>ç›®å‰å®˜æ–¹çš„ç¯„ä¾‹éƒ½æ˜¯ä½¿ç”¨ container patternã€‚ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯æœ‰ä¸€å€‹åªç®¡æ¥æ”¶ props ä¸¦ render çš„ç¬¨å…ƒä»¶ï¼Œèˆ‡åŒ…è¦†åœ¨ç¬¨å…ƒä»¶å¤–åœè² è²¬ç®¡ç†è³‡æ–™ä¸¦å°‡éœ€è¦çš„è³‡æ–™å‚³çµ¦ç¬¨å…ƒä»¶çš„ container å…ƒä»¶ã€‚è€Œè² è²¬èˆ‡ redux äº¤æµçš„æ­£æ˜¯é€™å€‹ container å…ƒä»¶ã€‚</p>

<p><a href="https://github.com/gaearon/react-redux">react-redux</a> æä¾›äº† <code class="language-plaintext highlighter-rouge">Provider</code> å…ƒä»¶èˆ‡ <code class="language-plaintext highlighter-rouge">connect</code> æ–¹æ³•ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">Provider</code> æ˜¯ä½¿ç”¨åœ¨æ‡‰ç”¨ç¨‹å¼çš„æ ¹å…ƒä»¶å…§ï¼Œè² è²¬å°‡å”¯ä¸€çš„ store å‚³ä¸‹å»çµ¦å…¶ä»–å­å…ƒä»¶ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">(</span><span class="nx">reducers</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="p">{()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">App</span> <span class="o">/&gt;</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="sr">/Provider</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è€Œ <code class="language-plaintext highlighter-rouge">connect</code> æœƒæ¥æ”¶ä¸€å€‹å‡½ç¤ºç•¶åƒæ•¸ä¸¦å›å‚³ä¸€å€‹ Component classã€‚
<code class="language-plaintext highlighter-rouge">connect</code> çš„åŠŸç”¨æ˜¯å°‡ dispatch æ–¹æ³•é€é props çš„æ–¹å¼åŠ åˆ°å…ƒä»¶ä¸­ã€‚
æˆ‘å€‘å¯ä»¥é€éé€™å€‹å‡½å¼ä¾†é¸å–é€™å€‹ container éœ€è¦ state çš„å“ªä¸€éƒ¨åˆ†ã€‚</p>

<p>ä¾‹å¦‚åœ¨ counter container ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åªé¸å– state è£¡çš„ counter éƒ¨åˆ†ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">select</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">CounterApp</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="nx">counter</span><span class="p">,</span> <span class="nx">dispatch</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Counter</span> <span class="nx">counter</span><span class="o">=</span><span class="p">{</span><span class="nx">counter</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">select</span><span class="p">)(</span><span class="nx">CounterApp</span><span class="p">)</span>
</code></pre></div></div>

<p>ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ç”¨ <code class="language-plaintext highlighter-rouge">select</code>ï¼Œé‚£éº¼åœ¨ <code class="language-plaintext highlighter-rouge">Connector</code> è£¡æ¥æ”¶åˆ°çš„å°±æ˜¯æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„å®Œæ•´ state äº†ã€‚</p>

<h2 id="ç¸½çµ">ç¸½çµ</h2>
<p>Redux æ˜¯ä¸€å€‹ä¿æœ‰ Flux ç‰¹æ€§ä½†åœ¨å¯¦ä½œä¸Šå»åˆæ²’æœ‰é‚£éº¼åƒåŸç”Ÿ Flux çš„ä¸€å€‹ libraryã€‚å®ƒæ¸›å°‘äº†è¨±å¤š boilerplater ä¸¦ç°¡åŒ–äº† Store å…§éƒ¨çš„ç¨‹å¼ç¢¼ã€‚
å¦‚æœæœ‰äººå° redux è™•ç†éåŒæ­¥æœ‰èˆˆè¶£çš„è©±å¯ä»¥åƒè€ƒ <a href="https://github.com/Rhadow/redux-example/tree/feature/redux%401.0">redux-example</a>ï¼Œè£¡é¢æœ‰ç”¨åˆ°ä¸€é»åœ¨æœ¬æ–‡ä¸­æœªæåˆ°çš„ middlewareã€‚
æœ€å¾Œï¼Œå„ä½å¦‚æœå°æ–‡ç« å…§å®¹æœ‰ä»»ä½•å»ºè­°æˆ–æŒ‡æ­£ï¼Œæ­¡è¿ç•™è¨€æŒ‡æ•™ã€‚</p>

:ET